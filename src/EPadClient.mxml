<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   xmlns:components="components.*"
			   xmlns:classes="classes.*"
			   minWidth="978" minHeight="608"
			   skinClass="skins.ApplicationSkin"
			   creationComplete="application_creationCompleteHandler(event)">
	<fx:Script>
		<![CDATA[
			import caurina.transitions.Tweener;
			
			import classes.UIController;
			
			import events.LoginEvent;
			import events.MenuBarSelectedIndexChangedEvent;
			
			import mx.core.IVisualElementContainer;
			import mx.events.FlexEvent;
			
			protected function loginHandler(event:LoginEvent):void
			{
				if (event.success)
				{
					IVisualElementContainer(homeContainer.parent).swapElementsAt(0, 1);
					homeContainer.height = homePage.measuredHeight-10;
					homeContainer.top = -homeContainer.height;
					homeContainer.alpha = 1;
					Tweener.addTween(homePage, {alpha:0, time:1});
					Tweener.addTween(homeContainer, {top:0, time:1});
				}
				else
				{
					trace('fale: '+event.error);
				}
			}
			
			protected function menuBar_menuBarSelectedIndexChangedEventHandler(event:MenuBarSelectedIndexChangedEvent):void
			{
				viewStack.selectedIndex = event.newIndex;
			}
			
			protected function application_creationCompleteHandler(event:FlexEvent):void
			{
				UIController.instance.user.addEventListener(LoginEvent.name, loginHandler);
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
	</fx:Declarations>
	<fx:Style source="css/global.css"/>
	<s:Group width="100%" height="100%">
		<s:Label left="0" right="10" top="10" height="30" textAlign="right" text="Welcome, {UIController.instance.user.username}"/>
		<s:Image left="51" top="15" source="@Embed(source='assets/logo.png')" width="193" height="71"/>
		<components:MenuBar id="menuBar" right="20" top="21" menuBarSelectedIndexChangedEvent="menuBar_menuBarSelectedIndexChangedEventHandler(event)"/>
		
		<mx:ViewStack id="viewStack" left="10" top="100" right="10" bottom="28">
			<s:NavigatorContent width="100%" height="100%">
				<s:Group width="100%" height="100%" clipAndEnableScrolling="true">
					<components:HomeContainer id="homeContainer" width="100%" height="100%" alpha="0"/>
					<components:HomePage id="homePage" width="100%" height="100%" visible="true" includeInLayout="true"/>
				</s:Group>
			</s:NavigatorContent>
			<s:NavigatorContent width="100%" height="100%">
				<components:StorePage width="100%" height="100%"/>
			</s:NavigatorContent>
			<s:NavigatorContent width="100%" height="100%">
				<s:Label text="account"/>
			</s:NavigatorContent>
			<s:NavigatorContent width="100%" height="100%">
				<s:Label text="help"/>
			</s:NavigatorContent>
		</mx:ViewStack>
	</s:Group>
</s:Application>